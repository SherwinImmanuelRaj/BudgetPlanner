<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Planning App</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Google APIs -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <div class="app-container">
        <!-- Google Auth Status -->
        <div id="authStatus" class="auth-status hidden">
            <div class="auth-content">
                <span id="authMessage">Connecting to Google Drive...</span>
                <div class="sync-indicator" id="syncIndicator">
                    <div class="sync-spinner"></div>
                </div>
            </div>
        </div>

        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">Budget Planner</h1>
                <div class="header-controls">
                    <div class="auth-controls" id="authControls">
                        <button id="signInBtn" class="glass-button auth-btn" title="Sign in to Google">
                            <svg class="auth-icon" viewBox="0 0 24 24">
                                <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                                <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                                <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                                <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                            </svg>
                            Sign In
                        </button>
                        <div id="userInfo" class="user-info hidden">
                            <img id="userAvatar" class="user-avatar" src="" alt="User">
                            <span id="userName" class="user-name"></span>
                            <button id="signOutBtn" class="glass-button sign-out-btn" title="Sign Out">
                                Sign Out
                            </button>
                        </div>
                    </div>
                    <div class="month-navigator">
                        <button id="prevMonth" class="nav-arrow glass-button" title="Previous Month">
                            ‚Äπ
                        </button>
                        <div class="current-month" id="currentMonth">
                            <!-- Dynamic month/year display -->
                        </div>
                        <button id="nextMonth" class="nav-arrow glass-button" title="Next Month">
                            ‚Ä∫
                        </button>
                    </div>
                    <button id="themeToggle" class="glass-button theme-toggle" title="Toggle Theme">
                        üåô
                    </button>
                    <button id="adminPanel" class="glass-button admin-btn" title="Admin Panel">
                        ‚öôÔ∏è Admin
                    </button>
                    <button id="exportPDF" class="glass-button export-btn" title="Export to PDF">
                        üìÑ Export PDF
                    </button>
                </div>
            </div>
        </header>

        <!-- Sign In Prompt -->
        <div id="signInPrompt" class="sign-in-prompt">
            <div class="prompt-content glass-card">
                <h2>Welcome to Budget Planner</h2>
                <p>Your personal finance management app with cloud storage</p>
                <div class="prompt-features">
                    <div class="feature-item">
                        <span class="feature-icon">‚òÅÔ∏è</span>
                        <span>Google Drive Sync</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">üìä</span>
                        <span>Google Sheets Analysis</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">üîÑ</span>
                        <span>Multi-device Access</span>
                    </div>
                </div>
                <p class="prompt-message">Please sign in with Google to access your budget data</p>
                <button id="promptSignInBtn" class="glass-button sign-in-prompt-btn" onclick="budgetApp.signIn()">
                    <svg class="auth-icon" viewBox="0 0 24 24">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                    </svg>
                    Sign In with Google
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Dashboard Section -->
            <section class="dashboard-section">
                <!-- Summary Cards -->
                <div class="summary-cards">
                    <div class="summary-card glass-card">
                        <h3>Total Income</h3>
                        <div class="amount" id="totalIncome">‚Çπ0.00</div>
                    </div>
                    <div class="summary-card glass-card">
                        <h3>Total Expenses</h3>
                        <div class="amount" id="totalExpenses">‚Çπ0.00</div>
                    </div>
                    <div class="summary-card glass-card">
                        <h3>Remaining</h3>
                        <div class="amount" id="remainingAmount">‚Çπ0.00</div>
                    </div>
                    <div class="summary-card glass-card carry-forward">
                        <h3>Carried Forward</h3>
                        <div class="amount" id="carriedAmount">‚Çπ0.00</div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-grid">
                    <div class="chart-container glass-card">
                        <h3>Expense Split</h3>
                        <canvas id="expenseChart" width="300" height="300"></canvas>
                    </div>
                    <div class="chart-container glass-card">
                        <h3>6-Month Efficiency Trend</h3>
                        <canvas id="efficiencyChart" width="300" height="300"></canvas>
                    </div>
                    <div class="chart-container glass-card">
                        <h3>Available vs Used</h3>
                        <canvas id="balanceChart" width="300" height="300"></canvas>
                    </div>
                </div>
            </section>

            <!-- Income Table -->
            <section class="table-section">
                <div class="section-header">
                    <h2 class="section-title">Income</h2>
                    <div class="table-actions">
                        <button class="icon-button" onclick="budgetApp.addRow('income')" title="Add Income">
                            <svg class="add-icon" viewBox="0 0 24 24">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                        </button>
                        <button class="icon-button" onclick="budgetApp.showDeletePanel('income')" title="Delete Income Items">
                            <svg class="delete-icon" viewBox="0 0 24 24">
                                <polyline points="3,6 5,6 21,6"></polyline>
                                <path d="m19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="table-container glass-card">
                    <table id="incomeTable" class="budget-table">
                        <thead>
                            <tr>
                                <th class="tooltip-header" data-tooltip="Sequential number for income items">S.No</th>
                                <th class="tooltip-header" data-tooltip="Source of income (salary, freelance, etc.)">Income Source</th>
                                <th class="tooltip-header" data-tooltip="Amount received from this income source">Amount (‚Çπ)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dynamic rows will be added here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Fixed Expenses Table -->
            <section class="table-section">
                <div class="section-header">
                    <h2 class="section-title">Fixed Expenses</h2>
                    <div class="table-actions">
                        <button class="icon-button" onclick="budgetApp.addRow('fixedExpenses')" title="Add Fixed Expense">
                            <svg class="add-icon" viewBox="0 0 24 24">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                        </button>
                        <button class="icon-button" onclick="budgetApp.showManagePanel('fixedExpenses')" title="Manage Fixed Expenses">
                            <svg class="manage-icon" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="m12,1l2.09,6.26l6.91.74-5,4.99,1.18,6.91-6.18-3.24-6.18,3.24,1.18-6.91-5-4.99,6.91-.74z"></path>
                            </svg>
                        </button>
                        <button class="icon-button" onclick="budgetApp.showDeletePanel('fixedExpenses')" title="Delete Fixed Expense Items">
                            <svg class="delete-icon" viewBox="0 0 24 24">
                                <polyline points="3,6 5,6 21,6"></polyline>
                                <path d="m19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="table-container glass-card">
                    <table id="fixedExpensesTable" class="budget-table">
                        <thead>
                            <tr>
                                <th class="tooltip-header" data-tooltip="Sequential number for fixed expenses">S.No</th>
                                <th class="tooltip-header" data-tooltip="Name of the fixed expense (rent, utilities, etc.)">Fixed Expense</th>
                                <th class="tooltip-header" data-tooltip="Amount you planned to spend">Planned (‚Çπ)</th>
                                <th class="tooltip-header" data-tooltip="Amount you actually spent">Actual (‚Çπ)</th>
                                <th class="tooltip-header" data-tooltip="Difference between planned and actual (Planned - Actual)">Balance (‚Çπ)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dynamic rows will be added here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Other Expenses Table -->
            <section class="table-section">
                <div class="section-header">
                    <h2 class="section-title">Other Expenses</h2>
                    <div class="table-actions">
                        <button class="icon-button" onclick="budgetApp.addRow('otherExpenses')" title="Add Other Expense">
                            <svg class="add-icon" viewBox="0 0 24 24">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                        </button>
                        <button class="icon-button" onclick="budgetApp.showDeletePanel('otherExpenses')" title="Delete Other Expense Items">
                            <svg class="delete-icon" viewBox="0 0 24 24">
                                <polyline points="3,6 5,6 21,6"></polyline>
                                <path d="m19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="table-container glass-card">
                    <table id="otherExpensesTable" class="budget-table">
                        <thead>
                            <tr>
                                <th class="tooltip-header" data-tooltip="Sequential number for other expenses">S.No</th>
                                <th class="tooltip-header" data-tooltip="Name of the variable expense (shopping, etc.)">Other Expense</th>
                                <th class="tooltip-header" data-tooltip="Amount you actually spent">Amount (‚Çπ)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dynamic rows will be added here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Investment Table -->
            <section class="table-section">
                <div class="section-header">
                    <h2 class="section-title">Investment</h2>
                    <div class="table-actions">
                        <button class="icon-button" onclick="budgetApp.addRow('investment')" title="Add Investment">
                            <svg class="add-icon" viewBox="0 0 24 24">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                        </button>
                        <button class="icon-button" onclick="budgetApp.showDeletePanel('investment')" title="Delete Investment Items">
                            <svg class="delete-icon" viewBox="0 0 24 24">
                                <polyline points="3,6 5,6 21,6"></polyline>
                                <path d="m19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="table-container glass-card">
                    <table id="investmentTable" class="budget-table">
                        <thead>
                            <tr>
                                <th class="tooltip-header" data-tooltip="Sequential number for investment items">S.No</th>
                                <th class="tooltip-header" data-tooltip="Type of investment (stocks, bonds, savings, etc.)">Investment</th>
                                <th class="tooltip-header" data-tooltip="Amount invested">Amount (‚Çπ)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dynamic rows will be added here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Debt Table -->
            <section class="table-section">
                <div class="section-header">
                    <h2 class="section-title">Debt</h2>
                    <div class="table-actions">
                        <button class="icon-button" onclick="budgetApp.addRow('debt')" title="Add Debt">
                            <svg class="add-icon" viewBox="0 0 24 24">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                        </button>
                        <button class="icon-button" onclick="budgetApp.showManagePanel('debt')" title="Manage Debt">
                            <svg class="manage-icon" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="m12,1l2.09,6.26l6.91.74-5,4.99,1.18,6.91-6.18-3.24-6.18,3.24,1.18-6.91-5-4.99,6.91-.74z"></path>
                            </svg>
                        </button>
                        <button class="icon-button" onclick="budgetApp.showDeletePanel('debt')" title="Delete Debt Items">
                            <svg class="delete-icon" viewBox="0 0 24 24">
                                <polyline points="3,6 5,6 21,6"></polyline>
                                <path d="m19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="table-container glass-card">
                    <table id="debtTable" class="budget-table">
                        <thead>
                            <tr>
                                <th class="tooltip-header" data-tooltip="Sequential number for debt items">S.No</th>
                                <th class="tooltip-header" data-tooltip="Name of the debt (credit card, loan, etc.)">Debt</th>
                                <th class="tooltip-header" data-tooltip="Amount to be paid">Amount (‚Çπ)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dynamic rows will be added here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Travel & Entertainment Table -->
            <section class="table-section">
                <div class="section-header">
                    <h2 class="section-title">Travel & Entertainment</h2>
                    <div class="table-actions">
                        <button class="icon-button" onclick="budgetApp.addRow('travelEntertainment')" title="Add Travel & Entertainment">
                            <svg class="add-icon" viewBox="0 0 24 24">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                        </button>
                        <button class="icon-button" onclick="budgetApp.showDeletePanel('travelEntertainment')" title="Delete Travel & Entertainment Items">
                            <svg class="delete-icon" viewBox="0 0 24 24">
                                <polyline points="3,6 5,6 21,6"></polyline>
                                <path d="m19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="table-container glass-card">
                    <table id="travelEntertainmentTable" class="budget-table">
                        <thead>
                            <tr>
                                <th class="tooltip-header" data-tooltip="Sequential number for travel & entertainment items">S.No</th>
                                <th class="tooltip-header" data-tooltip="Name of the expense (vacation, movies, etc.)">Travel & Entertainment</th>
                                <th class="tooltip-header" data-tooltip="Amount you planned to spend">Planned (‚Çπ)</th>
                                <th class="tooltip-header" data-tooltip="Amount you actually spent">Actual (‚Çπ)</th>
                                <th class="tooltip-header" data-tooltip="Difference between planned and actual (Planned - Actual)">Balance (‚Çπ)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dynamic rows will be added here -->
                        </tbody>
                    </table>
                </div>
            </section>
        </main>

        <!-- Admin Panel Modal -->
        <div id="adminModal" class="modal-overlay hidden">
            <div class="modal-content glass-card">
                <div class="modal-header">
                    <h2>Admin Panel</h2>
                    <button class="close-btn" onclick="budgetApp.closeAdminPanel()">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="admin-section">
                        <h3>Fixed Expense Templates</h3>
                        <div class="template-form">
                            <input type="text" id="templateName" placeholder="Template Name" class="glass-input">
                            <input type="number" id="templatePlanned" placeholder="Planned Amount" class="glass-input">
                            <button id="addTemplate" class="glass-button">Add Template</button>
                        </div>
                        <div id="templatesList" class="templates-list"></div>
                    </div>
                    
                    <div class="admin-section">
                        <h3>Debt Templates</h3>
                        <div class="template-form">
                            <input type="text" id="debtTemplateName" placeholder="Debt Name" class="glass-input">
                            <input type="number" id="debtTemplateAmount" placeholder="Amount" class="glass-input">
                            <input type="number" id="debtTemplateMonths" placeholder="Months Remaining" class="glass-input">
                            <button id="addDebtTemplate" class="glass-button">Add Debt Template</button>
                        </div>
                        <div id="debtTemplatesList" class="templates-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Selection Panel -->
        <div id="deleteModal" class="modal-overlay hidden">
            <div class="modal-content glass-card">
                <div class="modal-header">
                    <h2>Delete Items</h2>
                    <button class="close-btn" onclick="budgetApp.closeDeleteSelectionPanel()">√ó</button>
                </div>
                <div class="modal-body">
                    <p>Select items to delete:</p>
                    <div id="deleteItemsList" class="delete-items-list"></div>
                    <div class="modal-actions">
                        <button id="confirmDelete" class="glass-button delete-confirm">Delete Selected</button>
                        <button onclick="budgetApp.closeDeleteSelectionPanel()" class="glass-button">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Manage Panel -->
        <div id="manageModal" class="modal-overlay hidden">
            <div class="modal-content glass-card">
                <div class="modal-header">
                    <h2>Manage Templates</h2>
                    <button class="close-btn" onclick="budgetApp.closeManagePanel()">√ó</button>
                </div>
                <div class="modal-body">
                    <div id="manageTemplatesList" class="manage-templates-list"></div>
                </div>
            </div>
        </div>

        <!-- Tooltip -->
        <div id="tooltip" class="tooltip hidden"></div>

        <!-- Error Toast -->
        <div id="errorToast" class="error-toast hidden">
            <div class="error-content">
                <span id="errorMessage"></span>
                <button class="close-error" onclick="budgetApp.hideError()">√ó</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Initialize the budget app when the page loads
        let budgetApp;
        document.addEventListener('DOMContentLoaded', () => {
            budgetApp = new BudgetApp();
        });
    </script>
</body>
</html>
